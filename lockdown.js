!function(){const e=document.createElement("link");e.rel="stylesheet",e.href="lockdown.css",document.head.appendChild(e)}();export const LOCKDOWN_LOST_FOCUS="‚Üπ",LOCKDOWN_LOST_MOUSE="üñ±",LOCKDOWN_MOBILE="üñ≥",LOCKDOWN_NOT_FULLSCREEN="‚õ∂",LOCKDOWN_TOOLS_SHOWING="‚óß";const modal=document.body.appendChild(document.createElement("div"));modal.className="lockdown-modal hidden";const modalContent=modal.appendChild(document.createElement("div")),modalTitle=modalContent.appendChild(document.createElement("h4")),modalText=modalContent.appendChild(document.createElement("p")),modalNotes=modalContent.appendChild(document.createElement("small")),modalTimer=modalContent.appendChild(document.createElement("div")),modalButtons=modalContent.appendChild(document.createElement("div")),cancelBtn=document.createElement("button"),startBtn=document.createElement("button"),fullScreenBtn=document.createElement("button"),modalInfo=modal.appendChild(document.createElement("footer"));var lockdownOptions={},focused=!0,mouseOver=!0,left=[],cameBack=[],locked=!1,started=!1,lockState="";function getLeaveTime(){let e=0;for(let n=0;n<cameBack.length;n++)e+=cameBack[n]-left[n];return e/1e3}function getCurrentLeaveTime(){return left.length&&left.length!=cameBack.length?(Date.now()-left[left.length-1])/1e3:0}function closeAssessment(){lockdownStop(),lockdownOptions.onLeaveTimeExceeded?lockdownOptions.onLeaveTimeExceeded():(modal.classList.remove("hidden"),modalTitle.textContent="ASSESSMENT CLOSED",modalText.innerHTML="Exiting lockdown mode is not allowed!",modalNotes.innerHTML=`You have left lockdown mode more than ${lockdownOptions.maxUnlock||10} seconds.`,modalTimer.innerHTML="This assessment is now closed.",modalButtons.innerHTML='<button onclick="history.back()"><i class="fa-solid fa-left-long"></i> Back</button>')}function hideModal(){console.log("removeWarningModal"),modal.classList.add("hidden")}function showWarningModal(e){modal.classList.remove("hidden"),modalTitle.textContent="WARNING",modalButtons.innerHTML="",showIssuesInModal(e),modalNotes.innerHTML=`You have left lockdown mode ${left.length} time(s).`;var n=getLeaveTime();setTimeout((function e(){let t=(lockdownOptions.maxUnlock||10)-(n+getCurrentLeaveTime());if(t<=0)return modalTimer.innerHTML="This assessment is closed.",void closeAssessment();modalTimer.innerHTML=`This assessment will close in ${t.toFixed(1)} seconds.`,locked||setTimeout(e,100)}),100)}function startModal(){modal.classList.remove("hidden"),modalTitle.innerHTML="Lockdown Mode",modalButtons.innerHTML="",modalButtons.appendChild(cancelBtn),startBtn.addEventListener("click",(e=>{hideModal(),start()})),cancelBtn.addEventListener("click",(e=>{hideModal(),lockdownStop(),lockdownOptions.onCancel?lockdownOptions.onCancel():history.back()})),updateStartModal(lockState=getUnlockState())}function updateStartModal(e){e?(startBtn.remove(),showIssuesInModal(e),modalText.innerHTML+="<p>Cannot start lockdown mode due to issue(s) above.</p>"):(modalText.innerHTML="\n      <p>Ready to proceed.</p>\n      <p>\n        Your exam will end and your instructor will be notified if you\n        <li>leave full-screen mode</li>\n        <li>switch to another application</li>\n        <li>move pointer outside current window</li>\n        <li>have developer tools displayed</li>\n      </p>\n    ",fullScreenBtn.remove(),modalButtons.prepend(startBtn))}function showIssuesInModal(e){modalText.innerHTML="",e.includes("üñ≥")&&(modalText.innerHTML="‚ö†Ô∏è Mobile browser detected.<br>"),e.includes("‚Üπ")&&(modalText.innerHTML="‚ö†Ô∏è Window lost focus (click inside window to refocus).<br>"),e.includes("üñ±")&&(modalText.innerHTML+="‚ö†Ô∏è Mouse not detected.<br>"),e.includes("‚õ∂")?(modalText.innerHTML+="‚ö†Ô∏è Full-screen mode required.<br>",modalButtons.prepend(fullScreenBtn)):(fullScreenBtn.remove(),e.includes("‚óß")&&(modalText.innerHTML+="‚ö†Ô∏è Toolbar or dev console detected.<br>"))}function getUnlockState(){let e="";focused||(e+="‚Üπ"),mouseOver||(e+="üñ±"),navigator.userAgent.toLowerCase().includes("mobile")&&(e+="üñ≥"),window.outerWidth+20>=screen.width&&window.outerHeight+20>=screen.height||(e+="‚õ∂");let n=window.outerHeight/window.innerHeight,t=window.outerWidth/window.innerWidth,o=t>n+.05||n>t+.05;return modalInfo.innerText=`fullscreenElement: ${document.fullscreenElement?"yes":"no"}\nscreen: ${screen.width}, ${screen.height}\n avail: ${screen.availWidth}, ${screen.availHeight}\n outer: ${window.outerWidth}, ${window.outerHeight}\n inner: ${window.innerWidth}, ${window.innerHeight}\n ratio: ${t.toFixed(2)}, ${n.toFixed(2)}\n  body: ${document.body.offsetWidth}, ${document.body.offsetHeight}`,o&&(e+="‚óß"),e}function startModal2(){modal.classList.remove("hidden"),modalTitle.innerHTML="Lockdown mode required",navigator.userAgent.toLowerCase().includes("mobile")?(modalText.innerHTML="Cannot use lockdown mode on mobile devices.",modalButtons.innerHTML=`\n      ${lockdownOptions.onCancel?'<button id="cancelLockdownBtn">Cancel</button>':""}\n    `):(modalText.innerHTML="Your exam will end and your instructor will be notified if you\n      <li>leave full-screen mode</li>\n      <li>switch to another application</li>\n      <li>move pointer outside current window</li>\n      <li>have developer tools showing</li>\n      ",modalButtons.innerHTML=`\n      <button id="startLockdownBtn">Start Lockdown Mode</button>\n      ${lockdownOptions.onCancel?'<button id="cancelLockdownBtn">Cancel</button>':""}\n    `,document.getElementById("startLockdownBtn").addEventListener("click",(e=>{console.log(lockdownOptions.disablePasscode,lockdownOptions.fsc),hideModal(),start(),lockdownOptions.onStart&&lockdownOptions.onStart()}))),lockdownOptions.onCancel&&document.getElementById("cancelLockdownBtn").addEventListener("click",(e=>{hideModal(),lockdownOptions.onCancel()}))}function isFullscreen(){return window.matchMedia("(display-mode: fullscreen)").matches}function isLocked(){if(focused&&!navigator.userAgent.toLowerCase().includes("mobile")){if(!lockdownOptions.disablePasscode||lockdownOptions.disablePasscode!==lockdownOptions.fsc){let e=window.outerWidth+20>=screen.width&&window.outerHeight+20>=screen.height;if(e||console.log("out of fullscreen"),!e)return;let n=window.outerHeight/window.innerHeight,t=window.outerWidth/window.innerWidth;if(n+.05<t||n-.05>t)return!1}return!0}}function checkAndWarn(){let e=getUnlockState();e!==lockState&&(lockState=e,started?(locked&&e&&(locked=!1,left.push(Date.now()),lockdownOptions.onLeave&&lockdownOptions.onLeave(),showWarningModal(e)),locked||e||(locked=!0,cameBack.push(Date.now()),lockdownOptions.onLock&&lockdownOptions.onLock(),hideModal()),!locked&&e&&showIssuesInModal(e)):updateStartModal(e))}function blurEvent(e){focused=!1,checkAndWarn(e)}function focusEvent(e){focused=!0,checkAndWarn(e)}function leaveEvent(e){mouseOver=!1,checkAndWarn(e)}function enterEvent(e){mouseOver=!0,checkAndWarn(e)}function start(){started=!0,lockdownOptions.onStart&&lockdownOptions.onStart()}function startEventListeners(){locked=!0,window.addEventListener("resize",checkAndWarn),document.addEventListener("fullscreenchange",checkAndWarn),document.addEventListener("visibilitychange",checkAndWarn),window.addEventListener("focus",focusEvent),window.addEventListener("blur",blurEvent),document.body.addEventListener("mouseenter",enterEvent),document.body.addEventListener("mouseleave",leaveEvent)}function removeEventListeners(){window.removeEventListener("resize",checkAndWarn),document.removeEventListener("fullscreenchange",checkAndWarn),document.removeEventListener("visibilitychange",checkAndWarn),window.removeEventListener("focus",focusEvent),window.removeEventListener("blur",blurEvent),document.body.removeEventListener("mouseenter",enterEvent),document.body.removeEventListener("mouseleave",leaveEvent)}cancelBtn.textContent="Cancel",startBtn.textContent="Start assessment",fullScreenBtn.textContent="Enter full-screen mode",fullScreenBtn.addEventListener("click",(e=>document.body.requestFullscreen()));export function lockdown(e){lockdownOptions=e||{},startEventListeners(),startModal()}export function lockdownStop(){removeEventListeners(),document.fullscreenElement&&document.exitFullscreen()}