!function(){const e=document.createElement("link");e.rel="stylesheet",e.href="lockdown.css",document.head.appendChild(e)}();const modal=document.body.appendChild(document.createElement("div"));modal.className="lockdown-modal hidden";const modalContent=modal.appendChild(document.createElement("div")),modalTitle=modalContent.appendChild(document.createElement("h4")),modalText=modalContent.appendChild(document.createElement("p")),modalNotes=modalContent.appendChild(document.createElement("small")),modalTimer=modalContent.appendChild(document.createElement("div")),modalButtons=modalContent.appendChild(document.createElement("div"));var lockdownOptions={},focused=!0,left=[],cameBack=[],locked=!1;function getLeavetime(){let e=0;for(let n=0;n<cameBack.length;n++)e+=cameBack[n]-left[n];return e/1e3}function getCurrentLeavetime(){return left.length&&left.length!=cameBack.length?(Date.now()-left[left.length-1])/1e3:0}function closeAssessment(){removeEventListeners(),modal.classList.remove("hidden"),modalTitle.textContent="ASSESSMENT CLOSED",modalText.innerHTML="Exiting lockdown mode is not allowed!",modalNotes.innerHTML=`You have left lockdown mode more than ${lockdownOptions.maxUnlock||10} seconds.`,modalTimer.innerHTML="This assessment is now closed.",modalButtons.innerHTML="",lockdownOptions.onLeaveTimeExceeded&&lockdownOptions.onLeaveTimeExceeded()}function hideModal(){console.log("removeWarningModal"),modal.classList.add("hidden")}function showWarningModal(e){modal.classList.remove("hidden"),modalTitle.textContent="WARNING",modalText.innerHTML="Exiting lockdown mode is not allowed!",modalNotes.innerHTML=`You have left lockdown mode ${left.length} time(s).`;var n=getLeavetime();setTimeout((function e(){let o=(lockdownOptions.maxUnlock||10)-(n+getCurrentLeavetime());o<=0?closeAssessment():(modalTimer.innerHTML=`This assessment will close in ${o.toFixed(1)} seconds.`,locked||setTimeout(e,100))}),100),e?modalButtons.innerHTML="":(modalButtons.innerHTML='\n      Please enter full-screen mode immediately.\n      <button id="fullscreenBtn">Enter full-screen mode</button>\n    ',document.getElementById("fullscreenBtn").addEventListener("click",(e=>{document.body.requestFullscreen()})))}function startModal(){modal.classList.remove("hidden"),modalTitle.textContent="Lockdown mode required",navigator.userAgent.toLowerCase().includes("mobile")?(modalText.innerHTML="Cannot use lockdown mode on mobile devices.",modalButtons.innerHTML=`\n      ${lockdownOptions.onCancel?'<button id="cancelLockdownBtn">Cancel</button>':""}\n    `):(modalText.innerHTML="Your exam will end and your instructor will be notified if you\n      <li>leave full-screen mode</li>\n      <li>switch to another application</li>\n      <li>move pointer outside current window</li>\n      <li>have developer tools showing</li>",modalButtons.innerHTML=`\n      <button id="startLockdownBtn">Start Lockdown Mode</button>\n      ${lockdownOptions.onCancel?'<button id="cancelLockdownBtn">Cancel</button>':""}\n    `,document.getElementById("startLockdownBtn").addEventListener("click",(e=>{hideModal(),start(),lockdownOptions.onStart&&lockdownOptions.onStart()}))),lockdownOptions.onCancel&&document.getElementById("cancelLockdownBtn").addEventListener("click",(e=>{hideModal(),lockdownOptions.onCancel()}))}function isFullscreen(){return window.matchMedia("(display-mode: fullscreen)").matches}function isLocked(){if(!focused)return;if(navigator.userAgent.toLowerCase().includes("mobile"))return;if(!(window.outerWidth+20>=screen.width&&window.outerHeight+20>=screen.height))return;let e=window.outerHeight/window.innerHeight,n=window.outerWidth/window.innerWidth;return!(e+.05<n||e-.05>n)||void 0}function checkAndWarn(){isLocked()?locked||(locked=!0,cameBack.push(Date.now()),lockdownOptions.onLock&&lockdownOptions.onLock(),hideModal()):locked&&(locked=!1,left.push(Date.now()),lockdownOptions.onLeave&&lockdownOptions.onLeave(),showWarningModal(isFullscreen()))}function leaveEvent(){focused=!1,checkAndWarn()}function refocusEvent(){focused=!0,checkAndWarn()}function start(){document.body.requestFullscreen().then((e=>{locked=!0,window.addEventListener("resize",checkAndWarn),document.addEventListener("fullscreenchange",checkAndWarn),document.addEventListener("visibilitychange",checkAndWarn),window.addEventListener("focus",refocusEvent),window.addEventListener("blur",leaveEvent),document.body.addEventListener("mouseenter",refocusEvent),document.body.addEventListener("mouseleave",leaveEvent)})).catch((e=>{console.error("Error attempting to enable full-screen mode:",e)}))}function removeEventListeners(){window.removeEventListener("resize",checkAndWarn),document.removeEventListener("fullscreenchange",checkAndWarn),document.removeEventListener("visibilitychange",checkAndWarn),window.removeEventListener("focus",refocusEvent),window.removeEventListener("blur",leaveEvent),document.body.removeEventListener("mouseenter",refocusEvent),document.body.removeEventListener("mouseleave",leaveEvent)}export function lockdown(e){lockdownOptions=e||{},startModal()}export function lockdownStop(){removeEventListeners(),document.fullscreenElement&&document.exitFullscreen()}