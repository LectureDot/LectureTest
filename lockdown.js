!function(){const e=document.createElement("link");e.rel="stylesheet",e.href="lockdown.css",document.head.appendChild(e)}();export const LOCKDOWN_LOST_FOCUS="‚Üπ",LOCKDOWN_LOST_MOUSE="üñ±",LOCKDOWN_MOBILE="üñ≥",LOCKDOWN_NOT_FULLSCREEN="‚õ∂",LOCKDOWN_TOOLS_SHOWING="‚óß";const MAX_SCREEN_RATIO_DIFF=.025,modal=document.body.appendChild(document.createElement("div"));modal.className="lockdown-modal hidden";const modalContent=modal.appendChild(document.createElement("div")),modalTitle=modalContent.appendChild(document.createElement("h4")),modalText=modalContent.appendChild(document.createElement("p")),modalNotes=modalContent.appendChild(document.createElement("small")),modalTimer=modalContent.appendChild(document.createElement("div")),modalButtons=modalContent.appendChild(document.createElement("div")),cancelBtn=document.createElement("button"),startBtn=document.createElement("button"),fullScreenBtn=document.createElement("button"),modalInfo=modal.appendChild(document.createElement("footer"));var lockdownOptions={},focused=!0,mouseOver=!0,left=[],cameBack=[],locked=!1,started=!1,lockState="";function getLeaveTime(){let e=0;for(let n=0;n<cameBack.length;n++)e+=cameBack[n]-left[n];return e/1e3}function getCurrentLeaveTime(){return left.length&&left.length!=cameBack.length?(Date.now()-left[left.length-1])/1e3:0}function closeAssessment(){fullScreenBtn.remove(),lockdownStop(),lockdownOptions.onLeaveTimeExceeded?lockdownOptions.onLeaveTimeExceeded():(modal.classList.remove("hidden"),modalTitle.textContent="ASSESSMENT CLOSED",modalText.innerHTML="Exiting lockdown mode is not allowed!",modalNotes.innerHTML=`You have left lockdown mode more than ${lockdownOptions.maxUnlock||10} seconds.`,modalTimer.innerHTML="This assessment is now closed.",modalButtons.innerHTML='<button onclick="history.back()"><i class="fa-solid fa-left-long"></i> Back</button>')}function hideModal(){console.log("removeWarningModal"),modal.classList.add("hidden")}function showWarningModal(e){modal.classList.remove("hidden"),modalTitle.textContent="WARNING",modalButtons.innerHTML="",showIssuesInModal(e),modalNotes.innerHTML=`You have left lockdown mode ${left.length} time(s).`;var n=getLeaveTime();setTimeout((function e(){let t=(lockdownOptions.maxUnlock||10)-(n+getCurrentLeaveTime());if(t<=0)return modalTimer.innerHTML="This assessment is closed.",void closeAssessment();modalTimer.innerHTML=`This assessment will close in ${t.toFixed(1)} seconds.`,locked||setTimeout(e,100)}),100)}function startModal(){modal.classList.remove("hidden"),modalTitle.innerHTML="Lockdown Mode",modalButtons.innerHTML="",modalButtons.appendChild(cancelBtn),startBtn.addEventListener("click",(e=>{hideModal(),start()})),cancelBtn.addEventListener("click",(e=>{hideModal(),lockdownStop(),lockdownOptions.onCancel?lockdownOptions.onCancel():history.back()})),updateStartModal(lockState=getUnlockState())}function updateStartModal(e){e?(startBtn.remove(),showIssuesInModal(e),modalText.innerHTML+="<p>Cannot start lockdown mode due to issue(s) above.</p>"):(modalText.innerHTML="\n      <p>Ready to proceed.</p>\n      <p>\n        Your exam will end and your instructor will be notified if you\n        <ul>\n          <li>leave full-screen mode</li>\n          <li>switch to another application</li>\n          <li>move pointer outside current window</li>\n          <li>have developer tools displayed</li>\n        </ul>\n      </p>\n    ",fullScreenBtn.remove(),modalButtons.prepend(startBtn))}function showIssuesInModal(e){if(fullScreenBtn.remove(),e.includes("üñ≥"))modalText.innerHTML="‚ö†Ô∏è Mobile browser detected.<br>";else{if(e.includes("‚õ∂"))return modalText.innerHTML="‚ö†Ô∏è Locked full-screen mode required.<br>",void modalButtons.prepend(fullScreenBtn);modalText.innerHTML="",e.includes("‚Üπ")&&(modalText.innerHTML+="‚ö†Ô∏è Window lost focus (click inside window to refocus).<br>"),e.includes("üñ±")&&(modalText.innerHTML+="‚ö†Ô∏è Mouse not detected.<br>"),e.includes("‚óß")&&(modalText.innerHTML+="‚ö†Ô∏è Toolbar or dev console detected.<br>")}}function getUnlockState(){let e="";focused||(e+="‚Üπ"),mouseOver||(e+="üñ±"),navigator.userAgent.toLowerCase().includes("mobile")&&(e+="üñ≥"),document.fullscreenElement||(e+="‚õ∂");const n=window.innerWidth/window.innerHeight,t=window.outerWidth/window.outerHeight,o=screen.availWidth/screen.availHeight,d=screen.width/screen.height,l=Math.abs(t-n),i=Math.abs(o-n),c=Math.abs(d-n);return l>.025&&i>.025&&c>.025&&(e+="‚óß"),modalInfo.innerHTML=`\n    fullscreen: ${document.fullscreenElement?"yes":"no"}<br>\n    inner: ${window.innerWidth}, ${window.innerHeight}, ${n.toFixed(2)}<br>\n    outer: ${window.outerWidth}, ${window.outerHeight}, ${t.toFixed(2)} (${l.toFixed(2)})<br>\n    avail: ${screen.availWidth}, ${screen.availHeight}, ${o.toFixed(2)} (${i.toFixed(2)})<br>\n    screen: ${screen.width}, ${screen.height}, ${d.toFixed(2)} (${c.toFixed(2)})<br>\n  `,e}function checkAndWarn(){let e=getUnlockState();e!==lockState&&(lockState=e,started?locked&&e?(locked=!1,left.push(Date.now()),lockdownOptions.onLeave&&lockdownOptions.onLeave(),showWarningModal(e)):locked||e?!locked&&e&&showIssuesInModal(e):(locked=!0,cameBack.push(Date.now()),lockdownOptions.onLock&&lockdownOptions.onLock(),hideModal()):updateStartModal(e))}function blurEvent(e){focused=!1,checkAndWarn(e)}function focusEvent(e){focused=!0,checkAndWarn(e)}function leaveEvent(e){mouseOver=!1,checkAndWarn(e)}function enterEvent(e){mouseOver=!0,checkAndWarn(e)}function start(){started=!0,lockdownOptions.onStart&&lockdownOptions.onStart()}function startEventListeners(){locked=!0,window.addEventListener("resize",checkAndWarn),document.addEventListener("fullscreenchange",checkAndWarn),document.addEventListener("visibilitychange",checkAndWarn),window.addEventListener("focus",focusEvent),window.addEventListener("blur",blurEvent),document.body.addEventListener("mouseenter",enterEvent),document.body.addEventListener("mouseleave",leaveEvent)}function removeEventListeners(){window.removeEventListener("resize",checkAndWarn),document.removeEventListener("fullscreenchange",checkAndWarn),document.removeEventListener("visibilitychange",checkAndWarn),window.removeEventListener("focus",focusEvent),window.removeEventListener("blur",blurEvent),document.body.removeEventListener("mouseenter",enterEvent),document.body.removeEventListener("mouseleave",leaveEvent)}cancelBtn.textContent="Cancel",startBtn.textContent="Start assessment",fullScreenBtn.textContent="Enter locked full-screen mode",fullScreenBtn.addEventListener("click",(e=>document.body.requestFullscreen()));export function lockdown(e){lockdownOptions=e||{},startEventListeners(),startModal()}export function lockdownStop(){removeEventListeners(),document.fullscreenElement&&document.exitFullscreen()}