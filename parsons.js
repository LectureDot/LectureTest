import{importStyleSheet}from"./ui/common.js";function addGridBgImage(e,t,n,r,a,s){var d=`<svg xmlns="http://www.w3.org/2000/svg" width="${s}" height="1" style="stroke:${a};stroke-width:${r}">`;for(let e=t;e<s;e+=n)d+=`<line x1="${e}" y1="0" x2="${e}" y2="1" />`;d+="</svg>",e.style.backgroundImage=`url('data:image/svg+xml;utf8,${encodeURIComponent(d)}')`,e.style.backgroundRepeat="repeat-y"}importStyleSheet("./parsons.css",import.meta.url);var id=0;export function showParsons(e,t,n,r,a,s){const d=++id,i=document.createElement("div"),o=document.createElement("div");function c(e){const t=document.querySelector(".dragging"),n=e.target.closest(".column");if(n==i&&r&&i.removeChild(t),n==o&&!t._hasArrows){const e=document.createElement("i");e.className=0==s?"icon-btn fa-solid fa-caret-right indent-control transparent":"icon-btn fa-solid fa-caret-right indent-control";const n=document.createElement("i");n.className="icon-btn fa-solid fa-caret-left indent-control transparent",t.insertBefore(e,t.firstChild),t.insertBefore(n,t.firstChild),e.addEventListener("click",(t=>{const r=t.target.parentElement;r._indents<s&&(e.style.paddingRight=`${parseInt(e.style.paddingRight||0)+20}px`,r._indents++,n.classList.remove("transparent")),r._indents<s?e.classList.remove("transparent"):e.classList.add("transparent"),l()})),n.addEventListener("click",(t=>{const r=t.target.parentElement;r._indents>0&&(r._indents--,e.style.paddingRight=parseInt(e.style.paddingRight||0)-20+"px",e.classList.remove("transparent")),r._indents?n.classList.remove("transparent"):n.classList.add("transparent"),l()})),t._hasArrows=!0,t._indents=0}setTimeout(l,100)}function l(){let e=o.children;const t=[];for(let n=0;n<e.length;n++){const r=e[n];"item"==r.className&&t.push(" ".repeat(r._indents)+r._text)}a&&a(t)}function g(e){e.preventDefault();const t=document.querySelector(".dragging"),n=e.target.closest(".column");if(t._from!==n._from)return;if(n&&n.classList.add("droppable"),t._hasArrows&&n==i){t.style.paddingRight=0,t._indents=0;const e=t.querySelector(".fa-caret-right");e&&e.remove();const n=t.querySelector(".fa-caret-left");n&&n.remove(),t._hasArrows=!1}const r=getDragAfterElement(n,e.clientY);null==r?n.appendChild(t):n.insertBefore(t,r)}function m(e){const t=e.target;t.classList.add("dragging"),t._from=d}e.appendChild(i),t.appendChild(o),i.className="column",o.className="right column",o._from=i._from=d,s&&addGridBgImage(o,40,20,1,"#c8c8ff",40+20*(s+1)),o.addEventListener("dragover",g),o.addEventListener("drop",c),i.addEventListener("dragover",g),i.addEventListener("drop",c),o.addEventListener("dragstart",(e=>{e.target.classList.add("dragging")})),o.addEventListener("dragend",(e=>{e.target.classList.remove("dragging")})),i.addEventListener("dragstart",(e=>{if(e.target.classList.add("dragging"),r){const e=document.querySelector(".dragging"),t=e.cloneNode(!0);t.id=e.id,t.className="item",t._text=e._text,t.addEventListener("dragstart",m),t.addEventListener("dragend",handleDragEnd),i.appendChild(t)}})),i.addEventListener("dragend",(e=>{e.target.classList.remove("dragging")})),n.forEach(((e,t)=>{const n=document.createElement("div");n.className="item",n.id=t,n.innerHTML=`<span>${e}</span>`,n.draggable=!0,n._text=e,n.addEventListener("dragstart",m),n.addEventListener("dragend",handleDragEnd),i.appendChild(n)}))}function handleDragEnd(e){e.target.classList.remove("dragging")}function getDragAfterElement(e,t){return[...e.querySelectorAll(".item:not(.dragging)")].reduce(((e,n)=>{const r=n.getBoundingClientRect(),a=t-r.top-r.height/2;return a<0&&a>e.offset?{offset:a,element:n}:e}),{offset:Number.NEGATIVE_INFINITY}).element}