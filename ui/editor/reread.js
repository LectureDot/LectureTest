import"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js";import"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/mode/simple.min.js";import"https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/search/searchcursor.js";const MODE_NAME="reread",TOKEN_START="‚¶ó",TOKEN_END="‚¶ò",GROUP_START="‚¶Ö",GROUP_END="‚¶Ü",COMMENT="‚ßª",ESCAPE="‚çø",TOKEN={CHAR:"‚¶óC",TEXT:"‚¶óT",OPERATOR:"‚¶óO",QUANT:"‚¶óG",QUANT_LAZY:"‚¶óL"},ALL_SYMBOLS=["‚¶ó","‚¶ò","‚¶Ö","‚¶Ü","‚ßª","‚çø"],CATEGORIES={GENERAL:{name:"‚Åù",hint:"General options"},OPTIONAL_TEXT:{name:"¬øAbc?",hint:"Optional text patterns (i.e., text that may or may not appear).",class:"rr-text"},TEXT:{name:"Abc",hint:"Common text patterns.",class:"rr-text"},CHARACTER:{name:"A",hint:"Special characters (e.g., tab) and character classes (e.g., alphanumeric).",class:"rr-char"},COUNT:{name:"A‚®Ø",hint:"Number of occurrences of preceding character or group.",class:"rr-count"},SPECIAL_CHAR:{name:ALL_SYMBOLS.join(""),hint:"These symbols are treated as special in this editor, and should not be pasted in directly.\nUse these buttons for inserting one of these special characters."}},RR_COMMENT_REGEX=new RegExp("[^‚çø]‚ßª"),RR_TOKEN_REGEX=new RegExp("‚çø.|‚¶Ö|‚¶Ü|‚¶ó.*?‚¶ò","g"),RE_COMMENT_OPEN="(?=|",RE_COMMENT_CLOSE=")",RE_NEWLINE="(?=|\\n)",RE_UNKNOWN_CHAR_REGEX=/\[.*?\]/y,RE_CUSTOM_QUANT_REGEX=/\{.*?\}/y,RE_NM_QUANT_REGEX=/^\{(\d+),(\d+)?\}\??$/,RE_N_QUANT_REGEX=/^\{(\d+)\}\??$/,RE_IGNORE_CASE_REGEX_TEST=/(?<!\\)\(\?i:/,RE_START_REGEX_TEST=/(?<![\\\[][^]*)\^/,RE_END_REGEX_TEST=/(?<!\\)\$\)*$/,REREAD_CHARACTER_SETS=[{re:"[\\s\\S]",altre:["[\\S\\s]","[^]","\\p{Any}","[\\W\\w]","[\\w\\W]","[\\D\\d]","[\\d\\D]"],char:"any char",text:"any text",optional:"any text?",hint:"any character (including whitespace)",hint_text:"one or more characters of any kind, including whitespace",hint_optional:"zero or more characters of any kind, including whitespace"},{re:"[.]",altre:["."],char:"inline char",text:"inline text",optional:"inline text?",hint:"any character except newline",hint_text:"one or more of any character except newlines",hint_optional:"zero or more of any character except newlines"},{re:"[\\n]",altre:["\\n","\n"],char:"‚§∂",hint:"newline (i.e., line break)"},{re:"[\\t]",altre:["\\t"],char:"tab",hint:"tab character"},{re:"[ ]",altre:[" "],text:"spaces",optional:"spaces?",hint_text:"one or more spaces",hint_optional:"zero or more spaces"},{re:"[ \\t]",altre:["[\\t ]"],char:"space/tab",text:"spaces/tabs",optional:"spaces/tabs?",hint:"space or tab character",hint_text:"one or more space or tab characters",hint_optional:"zero or more space or tab characters"},{re:"[\\s]",altre:["\\s","[^\\S]"],char:"whitespace",text:"whitespace",optional:"whitespace?",hint:"whitespace character (space, tab, newline)",hint_text:"one or more spaces or tabs or newlines",hint_optional:"zero or more spaces or tabs or newlines"},{re:"[\\S]",altre:["\\S","[^\\s]"],char:"not whitespace",text:"not whitespace",optional:"not whitespace?",hint:"any character except space, tab, or newline",hint_text:"one or more of any character except spaces, tabs, or newlines",hint_optional:"zero or more of any character except spaces, tabs, or newlines"},{re:"[\\p{L}]",altre:["\\p{L}","[^\\P{L}]"],char:"letter",text:"letters",optional:"letters?",hint:"any letter (including international letters)",hint_text:"one or more letters (including international letters)",hint_optional:"zero or more letters (including international letters)",sec:"alphanumeric",unicode:!0},{re:"[A-Za-z]",altre:["[a-zA-Z]"],char:"A-z",text:"english",optional:"english?",hint:"any english letter",hint_text:"one or more english letters",hint_optional:"zero or more english letters",sec:"alphanumeric"},{re:"[\\p{Ll}]",altre:["\\p{Ll}","[^\\P{Ll}]"],char:"lower",text:"lower",optional:"lower?",hint:"any lowercase letter (including international letters)",hint_text:"one or more lowercase letters (including international letters)",hint_optional:"zero or more lowercase letters (including international letters)",sec:"alphanumeric",unicode:!0},{re:"[a-z]",char:"a-z",text:"lower en",optional:"lower en?",hint:"any lowercase english letter",hint_text:"one or more lowercase english letters",hint_optional:"zero or more lowercase english letters",sec:"alphanumeric"},{re:"[\\p{Lu}]",altre:["\\p{Lu}","[^\\P{Lu}]"],char:"upper",text:"upper",optional:"upper?",hint:"any uppercase letter (including international letters)",hint_text:"one or more uppercase letters (including international letters)",hint_optional:"zero or more uppercase letters (including international letters)",sec:"alphanumeric",unicode:!0},{re:"[A-Z]",char:"A-Z",text:"upper en",optional:"upper en?",hint:"any uppercase english letter",hint_text:"one or more uppercase english letters",hint_optional:"zero or more uppercase english letters",sec:"alphanumeric"},{re:"[\\d]",altre:["\\d","[0-9]","[^\\D]"],char:"digit",text:"digits",optional:"digits?",hint:"any digit 0-9",hint_text:"one or more digits 0-9",hint_optional:"zero or more digits 0-9",sec:"alphanumeric"},{re:"[\\p{N}]",altre:["\\p{N}","[^\\P{N}]"],char:"numeric",text:"numeric",optional:"numeric?",hint:"any numeric character (including roman numerals IVXLCDM, and non-standard and international numeric chars like ¬Ω and ‡•ß)",hint_text:"one or more numeric characters (including roman numerals IVXLCDM, and non-standard and international numeric chars like ¬Ω and ‡•ß)",hint_optional:"zero or more numeric characters (including roman numerals IVXLCDM, and non-standard and international numeric chars like ¬Ω and ‡•ß)",sec:"alphanumeric",unicode:!0},{re:"[\\dA-Fa-f]",altre:["[A-Fa-f\\d]","[a-fA-F\\d]","[A-F\\da-f]","[a-f\\dA-F]","[\\da-fA-F]","[0-9a-fA-F]","[a-f0-9A-F]","[A-F0-9a-f]","[0-9A-Fa-f]","[a-fA-F0-9]","[A-Fa-f0-9]"],char:"hex",text:"hex",optional:"hex?",hint:"any hexadecimal character (0-9, a-f, A-F)",hint_text:"one or more hexadecimal characters (0-9, a-f, A-F)",hint_optional:"zero or more hexadecimal characters (0-9, a-f, A-F)",sec:"alphanumeric"},{re:"[01]",altre:["[0-1]","[10]"],char:"0-1",text:"binary",optional:"binary?",hint:"0 or 1",hint_text:"one or more binary digits (0s or 1s)",hint_optional:"zero or more binary digits (0s or 1s)",sec:"alphanumeric"},{re:"[\\p{L}\\d]",altre:["[\\d\\p{L}]","[\\p{L}0-9]","[0-9\\p{L}]"],char:"letter/digit",text:"letters/digits",optional:"letters/digits?",hint:"any letter (including international letters) or digit 0-9",hint_text:"one or more letters (including international letters) or digits 0-9",hint_optional:"zero or more letters (including international letters) or digits 0-9",sec:"alphanumeric",unicode:!0},{re:"[\\p{L}\\p{N}]",altre:["[\\p{N}\\p{L}]"],char:"alphanumeric",text:"alphanumeric",optional:"alphanumeric?",hint:"any alphanumeric character (including international letters and non-standard numeric chars like ¬Ω)",hint_text:"one or more alphanumeric characters (including international letters and non-standard numeric chars like ¬Ω)",hint_optional:"zero or more alphanumeric characters (including international letters and non-standard numeric chars like ¬Ω)",sec:"alphanumeric",unicode:!0},{re:"[A-Za-z\\d]",altre:["[\\da-zA-Z]","[a-z\\dA-Z]","[A-Z\\da-z]","[\\dA-Za-z]","[a-zA-Z\\d]","[A-Za-z0-9]","[a-zA-Z0-9]","[0-9A-Za-z]","[A-Z0-9a-z]","[a-z0-9A-Z]","[0-9a-zA-Z]"],char:"A-z0-9",text:"english/digits",optional:"english/digits?",hint:"any english letter or a digit",hint_text:"one or more english letters or digits 0-9",hint_optional:"zero or more english letters or digits 0-9",sec:"alphanumeric"},{re:"[\\p{P}]",altre:["\\p{P}","[^\\P{P}]"],char:"punctuation",text:"punctuation",optional:"punctuation?",hint:"any punctuation character",hint_text:"one or more punctuation characters",hint_optional:"zero or more punctuation characters",sec:"other",unicode:!0},{re:"[\\p{S}]",altre:["\\p{S}","[^\\P{S}]"],char:"symbol",text:"symbols",optional:"symbols?",hint:"any symbol",hint_text:"one or more symbols",hint_optional:"zero or more symbols",sec:"other",unicode:!0},{re:"[\\p{Emoji}]",altre:["\\p{Emoji}","[^\\P{Emoji}]"],char:"emoji",text:"emojis",optional:"emojis?",hint:"any emoji",hint_text:"one or more emojis",hint_optional:"zero or more emojis",sec:"other",unicode:!0},{re:"[\\p{P}\\p{S}\\p{E}]",altre:["[\\p{P}\\p{E}\\p{S}]","[\\p{S}\\p{P}\\p{E}]","[\\p{S}\\p{E}\\p{P}]","[\\p{E}\\p{P}\\p{S}]","[\\p{E}\\p{S}\\p{P}]"],char:"special char",text:"special chars",optional:"special chars?",hint:"any special character (punctuation, symbol, or emoji)",hint_text:"one or more special characters (punctuations, symbols, or emojis)",hint_optional:"zero or more special characters (punctuations, symbols, or emojis)",sec:"other",unicode:!0},{re:"[\\P{L}]",altre:["\\P{L}","[^\\p{L}]"],char:"not letter",text:"not letters",optional:"not letters?",hint:"any character that is not a letter",hint_text:"one or more characters that are not letters",hint_optional:"zero or more characters that are not letters",sec:"other",unicode:!0},{re:"[^A-Za-z]",altre:["[^a-zA-Z]"],char:"not A-z",text:"not english",optional:"not english?",hint:"any character that is not an english letter A-z",hint_text:"one or more characters that are not english letters A-z",hint_optional:"zero or more characters that are not english letters A-z",sec:"other"},{re:"[^\\p{L}\\d]",altre:["[^\\d\\p{L}]","[^\\p{L}0-9]","[^0-9\\p{L}]"],char:"not letter/digit",text:"not letters/digits",optional:"not letters/digits?",hint:"any character that is not a letter or digit",hint_text:"one or more characters that are not letters or digits",hint_optional:"zero or more characters that are not letters or digits",sec:"other",unicode:!0},{re:"[^\\p{L}\\p{N}]",altre:["[^\\p{N}\\p{L}]"],char:"not alphanumeric",text:"not alphanumeric",optional:"not alphanumeric?",hint:"any character that is not alphanumeric",hint_text:"one or more characters that are not alphanumeric",hint_optional:"zero or more characters that are not alphanumeric",sec:"other",unicode:!0},{re:"[^A-Za-z\\d]",altre:["[^a-zA-Z\\d]","[^\\dA-Za-z]","[^A-Z\\da-z]","[^a-z\\dA-Z]","[^\\da-zA-Z]","[^A-Za-z0-9]","[^a-zA-Z0-9]","[^0-9A-Za-z]","[^A-Z0-9a-z]","[^a-z0-9A-Z]","[^0-9a-zA-Z]"],char:"not A-z0-9",text:"not english/digits",optional:"not english/digits?",hint:"any character that is not an english letter or a digit",hint_text:"one or more characters that are not english letters and not digits",hint_optional:"zero or more characters that are not english letters and not digits",sec:"other"},{re:"[\\D]",altre:["[^\\d]","\\D"],char:"not digit",text:"not digits",optional:"not digits?",hint:"any character that is not a digit",hint_text:"one or more characters that are not digits",hint_optional:"zero or more characters that are not digits",sec:"other"}],REREAD_COMMON_PATTERNS=[{re:"-?\\d+",text:"integer",hint_text:"one or more digits, optionally preceded by a negative sign"},{re:"-?\\d+(\\.\\d+)?",text:"number",hint_text:"any standard number (e.g., -12.34, 0.5, 3); does not match scientific notation; does not capture numbers starting with a period (.2 doesn't match, but 0.2 matches)"},{re:"[a-zA-Z_][a-zA-Z0-9_]*",text:"var",hint_text:"valid variable name (letters A-z, digits 0-9, underscores _, cannot start with a digit)"},{re:"[a-zA-Z_$][a-zA-Z0-9_$]*",text:"js var",hint_text:"valid javascript variable name (letters A-z, digits 0-9, underscores _, dollar signs $, cannot start with a digit)"},{re:'(?<!\\\\)"(\\\\"|[^"\\n])*"',text:'"..."',hint_text:'text in double quotes (e.g., "hello world")'},{re:"(?<!\\\\)'(\\\\'|[^'\\n])*'",text:"'...'",hint_text:"text in single quotes (e.g., 'hello world')"},{re:"\\b[^.\\s@]+(\\.[^.\\s@]+)*@([^.\\s@]+\\.)+[^.\\s@]{2,63}\\b",text:"email",hint_text:"email address (e.g., hello@example.com)"},{re:"(https?:\\/\\/\\[[0-9a-fA-F:.]+((%|%25)\\w+)?\\]|(https?:\\/\\/)?(localhost|((25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d?\\d)|([\\p{L}\\d]([-\\p{L}\\d]*[\\p{L}\\d])?\\.)+[\\p{L}\\d]{2,63})\\b)(:\\d+)?(\\/([\\p{L}\\d\\-._~:\\/?#\\[\\]@!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)?",text:"url",hint_text:"URL (e.g., https://www.example.com/path?query=value)",unicode:!0},{re:"((25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d?\\d)",text:"ip",hint_text:"IPv4 address (e.g., 192.168.1.1)"},{re:"[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}",text:"uuid",hint_text:"UUID (e.g., 123e4567-e89b-12d3-a456-426655440000)"},{re:"([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})",text:"MAC",hint_text:"MAC address (e.g., 00:11:22:33:44:55)"},{re:"<[a-zA-Z][a-zA-Z0-9]*(\\s+[^>]*)?>",text:"<tag ...>",hint_text:'HTML/XML opening tag (e.g., <div id="main">)'},{re:"<\\/[a-zA-Z][a-zA-Z0-9]*>",text:"</tag>",hint_text:"HTML/XML closing tag (e.g., </div>)"},{re:"#([0-9a-fA-F]{3}){1,2}",text:"hex color",hint_text:"hexadecimal color code (e.g., #FFF or #FFFFFF)"},{re:"\\d{4}-\\d{2}-\\d{2}",text:"YYYY-MM-DD",hint_text:"date in YYYY-MM-DD format (e.g., 2023-10-27)"},{re:"(0?[1-9]|1[0-2])[\\/](0?[1-9]|[12]\\d|3[01])[\\/](\\d{2})?\\d{2}",text:"M/D/YY",hint_text:"date in M/D/YY or MM/DD/YYYY format (e.g., 1/1/23 or 01/01/2023)"},{re:"(0?[1-9]|[12]\\d|3[01])[\\/](0?[1-9]|1[0-2])[\\/](\\d{2})?\\d{2}",text:"D/M/YY",hint_text:"date in D/M/YY or DD/MM/YYYY format (e.g., 1/1/23 or 01/01/2023)"},{re:"(0?[0-9]|1[0-9]|2[0-3]):[0-5][0-9]",text:"hh:mm",hint_text:"time in hh:mm format (e.g., 14:30 or 1:59)"},{re:"(0?[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]",text:"hh:mm:ss",hint_text:"time in hh:mm:ss format (e.g., 14:30:45 or 1:59:59)"},{re:"(0?[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]\\.[0-9]{3}",text:"hh:mm:ss.SSS",hint_text:"time in hh:mm:ss.SSS format (e.g., 14:30:45.123 or 1:59:59.999)"}],REREAD=[{re:"(",rr:"‚¶Ö"},{re:")",rr:"‚¶Ü"},{re:"(?:",rr:"‚¶Ö"},{re:"(?i:",rr:"‚¶Ö"},{re:"(?-i:",rr:"‚¶Ö"},{re:"[\\w]",altre:["\\w"],rr:TOKEN.CHAR+"A-z0-9_‚¶ò"},{re:"[\\W]",altre:["\\W"],rr:TOKEN.CHAR+"not A-z0-9_‚¶ò"},{re:"|",name:"or",rr:TOKEN.OPERATOR+"or‚¶ò",hint:"ùô§ùôß operator (i.e., disjunction); used to indicate valid alternatives (e.g., HELLOùô§ùôßHI)",example:'"(HELLOùô§ùôßHI) WORLD" will match either "HELLO WORLD" or "HI WORLD"',class:"rr-operator"},...REREAD_CHARACTER_SETS.filter((e=>e.char)).map((e=>({name:e.char,cat:CATEGORIES.CHARACTER,rr:TOKEN.CHAR+e.char+"‚¶ò",re:e.re,altre:e.altre,hint:e.hint,sec:e.sec}))),...REREAD_CHARACTER_SETS.filter((e=>e.text)).map((e=>({name:e.text,cat:CATEGORIES.TEXT,rr:TOKEN.TEXT+e.text+"‚¶ò",re:e.re+"+",altre:e.altre?.map((e=>e+"+")),hint:e.hint_text,sec:e.sec}))),...REREAD_CHARACTER_SETS.filter((e=>e.optional)).map((e=>({name:e.optional,cat:CATEGORIES.OPTIONAL_TEXT,rr:TOKEN.TEXT+e.optional+"‚¶ò",re:e.re+"*",altre:e.altre?.map((e=>e+"*")),hint:e.hint_optional,sec:e.sec}))),...REREAD_COMMON_PATTERNS.map((e=>({name:e.text,cat:CATEGORIES.TEXT,rr:TOKEN.TEXT+e.text+"‚¶ò",re:e.re,altre:e.altre,needsParen:!0,hint:e.hint_text,sec:"token"}))),{re:"+",altre:["{1,}"],name:"1+",rr:TOKEN.QUANT+"1+‚¶ò",hint:"one or more instances of preceding character or group (more is preferred)",cat:CATEGORIES.COUNT},{re:"*",altre:["{0,}"],name:"0+",rr:TOKEN.QUANT+"0+‚¶ò",hint:"zero or more instances of preceding character or group (more is preferred)",cat:CATEGORIES.COUNT},{re:"?",altre:["{0,1}"],name:"0 or 1",rr:TOKEN.QUANT+"0 or 1‚¶ò",hint:"zero or one instances of preceding character or group (one is preferred)",cat:CATEGORIES.COUNT},{re:"+?",altre:["{1,}?"],name:"1+?",rr:TOKEN.QUANT_LAZY+"1+?‚¶ò",hint:"one or more instances of preceding character or group (less is preferred)",cat:CATEGORIES.COUNT,sec:"lazy",class:"rr-lazy"},{re:"*?",altre:["{0,}?"],name:"0+?",rr:TOKEN.QUANT_LAZY+"0+?‚¶ò",hint:"zero or more instances of preceding character or group (less is preferred)",cat:CATEGORIES.COUNT,sec:"lazy",class:"rr-lazy"},{re:"??",altre:["{0,1}?"],name:"0 or 1?",rr:TOKEN.QUANT_LAZY+"0 or 1‚¶ò",hint:"zero or one instances of preceding character or group (zero is preferred)",cat:CATEGORIES.COUNT,sec:"lazy",class:"rr-lazy"}];function isEnclosed(e,t="(",r=")",n="\\"){if(e.length<2||!e.startsWith(t)||!e.endsWith(r))return!1;let a=1,o=!1;for(let i=1;i<e.length;i++){const c=e[i];if(o)o=!1;else if(c!==n){if(c===t)a++;else if(c===r){if(a--,i===e.length-1)break;if(a<=0)return!1}}else o=!0}return 0===a}function debounce(e,t){let r;return function(){const n=this,a=arguments;clearTimeout(r),r=setTimeout((()=>e.apply(n,a)),t)}}export const rereadBtns=[{name:"‚¶Ö ‚¶Ü",hint:"group",class:"rr-operator",cat:CATEGORIES.operator,action:e=>{e.replaceSelection("‚¶Ö"+e.getSelection()+"‚¶Ü"),e.focus()}},...REREAD.filter((e=>e.name)),...ALL_SYMBOLS.map((e=>({name:e,cat:CATEGORIES.SPECIAL_CHAR,rr:"‚çø"+e,re:e,hint:`insert special character '${e}'`,class:"special-char"}))),{name:"‚ßª COMMENT",hint:"add a comment (the comment will be ignored for pattern matching)",class:"rr-comment-btn",action:e=>{const t=e.getSelection();e.replaceSelection("‚ßª"+t),e.focus()}}];function defaultAction(e){return function(t){t.replaceSelection(e.rr),t.focus()}}function defaultGroupAction(e){return function(t){const r=t.getSelection();r?1==r.length?t.replaceSelection(r+e.rr):t.replaceSelection("‚¶Ö"+r+"‚¶Ü"+e.rr):t.replaceSelection(e.rr),t.focus()}}for(const e of rereadBtns)e.action||(e.cat===CATEGORIES.COUNT?e.action=defaultGroupAction(e):e.action=defaultAction(e));const div=(...e)=>{const t=document.createElement("div");return t.classList.add(...e),t};export function rereadButtonBar(e){const t=div("rr-button-row"),r={};for(const n of rereadBtns){const a=div(n.class||n.cat?.class);if(a.innerText=n.name,a.title=n.hint||"",n.example&&(a.title+=(a.title?"; ":"")+n.example),a.onclick=()=>n.action(e,a),n.cat?.name){if(!r[n.cat.name]){const e=div(n.cat.class,"rr-dropdown-button");e.innerText=n.cat.name+"  üûÉ";const a=e.appendChild(div("rr-button-menu"));a.innerHTML=n.cat.hint,r[n.cat.name]={default:a.appendChild(div("rr-button-row"))},t.appendChild(e)}n.sec&&!r[n.cat.name][n.sec]&&(r[n.cat.name][n.sec]=r[n.cat.name].default.parentElement.appendChild(div("rr-button-row"))),r[n.cat.name][n.sec||"default"].appendChild(a)}else t.appendChild(a)}return t.querySelectorAll(".selectable:not(:has(*))").forEach((t=>{t.textContent.includes("case")?e.caseSelector=t:t.textContent.includes("start")?e.startSelector=t:t.textContent.includes("end")&&(e.endSelector=t)})),t}const sortedRereadPatterns=REREAD.toSorted(((e,t)=>e.re.length>t.re.length?-1:1));export function rrNoComments(e){return e.replace(new RegExp("(?<!‚çø)‚ßª.*","gm"),"")}export function checkRr(e){if(!e)return;const t=(e=rrNoComments(e)).match(new RegExp(Object.values(TOKEN).map((([e,t])=>`${e}.*?${t}`)).join("|"),"gm"));if(!t)return!0;for(let e of t)if(!REREAD.find((t=>t.rr===e)))return!1;return!0}const FLAG_GROUP_REGEX=/\(\?(?![=!<>])[^:]*:/y;export function isUnsupportedRe(e){try{new RegExp(e)}catch(e){return e.message}let t=0;for(;t<e.length;){if("\\"===e[t]){if(t++,/[k\d]/.test(e[t]))return`Unsupported regular expression: Backreference at [${t-1}]: \\${e.slice(t-1,t+1)}`;if("b"===e[t]||"B"===e[t])return`Unsupported regular expression: Boundary at [${t-1}]: \\${e.slice(t-1,t+1)}`;continue}if(e.startsWith("(?=|",t)){let r=t+4,n=!1;for(;r<e.length;){if("\\"===e[r])r++;else if(e.startsWith(")",r)){r+=1,n=!0;break}r++}if(r>=e.length&&!n)return`Unsupported regular expression: Incomplete comment at [${t}]: ${e.slice(t)}`;t=r;continue}FLAG_GROUP_REGEX.lastIndex=t;const r=FLAG_GROUP_REGEX.exec(e);if(r){if("(?:"!==r[0]&&"(?i:"!==r[0]&&"(?-i:"!==r[0])return`Unsupported regular expression: Unsupported inline flag(s) at [${t}]: `+r[0];t+=r[0].length}else{if(e.startsWith("(?",t))return"="===e[t+2]||"!"===e[t+2]?`Unsupported regular expression: Lookahead functionality at [${t}]: `+e.slice(t,t+3):"<"!==e[t+2]||"="!==e[t+3]&&"!"!==e[t+3]?"<"===e[t+2]?`Unsupported regular expression: Named group at [${t}]: `+e.slice(t,t+10)+"...":`Unsupported regular expression functionality at [${t}]: `+e.slice(t,t+4)+"...":`Unsupported regular expression: Lookbehind functionality at [${t}]: `+e.slice(t,t+4);t++}}}export function textToRe(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}function customQuantRrToRe(e){let t="{"+e.slice(2,-1).replace(/\+|\-/,",")+"}";return e.startsWith(TOKEN.QUANT_LAZY)&&(t+="?"),t}export function rrToRe(e,t,r,n=!0){e||(e="");let a="";const o=e.split("\n");return o.forEach(((e,t)=>{if(e.startsWith("‚ßª"))return void(n&&(a+="(?=|"+textToRe(e.slice(1))+")"));let r;RR_TOKEN_REGEX.lastIndex=0;let i=0,c=0;const s=e.match(RR_COMMENT_REGEX);for(;(r=RR_TOKEN_REGEX.exec(e))&&(i=r.index,!(s&&s.index+1<i));){a+=textToRe(e.slice(c,r.index)),c=r.index+r[0].length;let t=sortedRereadPatterns.find((e=>e.rr===r[0]));t||(r[0].startsWith(TOKEN.CHAR+"[")&&r[0].endsWith("]‚¶ò")?t={re:r[0].slice(TOKEN.CHAR.length,-1)}:(r[0].startsWith(TOKEN.QUANT)||r[0].startsWith(TOKEN.QUANT_LAZY))&&r[0].endsWith("‚¶ò")&&(t={re:customQuantRrToRe(r[0])})),t&&(t.needsParen?a+="("+t.re+")":a+=t.re)}a+=textToRe(e.slice(c,s?s.index+1:e.length)),s&&n?a+="(?=|"+textToRe(e.slice(s.index+2))+")":n&&t<o.length-1&&(a+="(?=|\\n)")})),a=t?`(?-i:${a})`:`(?i:${a})`,r&&(a=`^${a}$`),a}function customQuantReToRr(e){let t=e.match(RE_NM_QUANT_REGEX);if(t){let r=e.endsWith("?")?TOKEN.QUANT_LAZY:TOKEN.QUANT;return r+=t[1],t[2]?r+="-"+t[2]:r+="+",r+"‚¶ò"}return t=e.match(RE_N_QUANT_REGEX),t?(e.endsWith("?")?TOKEN.QUANT_LAZY:TOKEN.QUANT)+t[1]+"‚¶ò":""}export function reToRr(e,t){if(!e)return"";const r=isUnsupportedRe(e);if(r)return t&&t(r),"";e=e.replaceAll("\n","\\n");let n="",a=0;for(;a<e.length;){if(e.startsWith("(?=|\\n)",a)){n+="\n",a+=7;continue}if(e.startsWith("(?=|",a)){n+="‚ßª";for(let t=a+4;t<e.length;t++)if("\\"===e[t])n+=e[t+1],t++;else{if(e.startsWith(")",t)){n+="\n",a=t+1;break}n+=e[t]}continue}let t=!1;for(const r of sortedRereadPatterns){let o=[r.re];r.altre?.constructor===Array&&(o=o.concat(r.altre));for(let i of o){if(e.startsWith(i,a)){n+=r.rr,a+=i.length,t=!0;break}if(e.startsWith("("+i+")",a)){n+=r.rr,a+=i.length+2,t=!0;break}}if(t)break}if(!t){const r=e[a];if("\\"===r){n+=e[a+1],a+=2;continue}if(RE_UNKNOWN_CHAR_REGEX.lastIndex=a,t=RE_UNKNOWN_CHAR_REGEX.exec(e),t){n+=TOKEN.CHAR+t[0]+"‚¶ò",a+=t[0].length;continue}if(RE_CUSTOM_QUANT_REGEX.lastIndex=a,t=RE_CUSTOM_QUANT_REGEX.exec(e),t){n+=customQuantReToRr(t[0]),a+=t[0].length;continue}if("^"===r||"$"===r){a++;continue}n+=r,a++}}return isEnclosed(n,"‚¶Ö","‚¶Ü")&&(n=n.slice(1,-1)),n=n.replaceAll("‚¶Ö‚¶Ü",""),n}export function textToRr(e){e=e.replace(new RegExp("‚çø","g"),"‚çø‚çø");for(let t of ALL_SYMBOLS)e=e.replace(new RegExp(t,"g"),"‚çø"+t);return e}export function rrToHTML(e){const t=e=>e.replace("<","&lt;").replace(">","&gt;");let r="<pre>",n="start",a=0;for(;a<e.length;){const o=e.slice(a);let i;for(let e of REREAD_SIMPLE_MODE[n])if(i=o.match(new RegExp("^"+e.regex.source)),i){const o=i[0].length,c=t(i[0]);if(e.token){let t=e.token?.split(" ").map((e=>`cm-${e}`)).join(" ")||"";t&&(t=` class="rr-token ${t}"`),r+=`<span${t}>${c}</span>`}else r+=c;n=e.next||n,a+=o;break}i||(r+=t(e[a]),a++)}return r+"</pre>"}export function rrToText(e){if(!e)return"";let t="",r=0;for(;r<e.length;){const n=e[r];if("‚çø"===n)t+=e[r+1],r+=2;else if("‚ßª"===n){const t=0===r||"\n"===e[r-1];for(;r<e.length&&"\n"!==e[r];)r++;t&&r++}else{for(const t of REREAD)if(e.startsWith(t.rr,r))return!1;t+=n,r++}}return t}export function matchRe(e,t,r,n,a,o){try{return new RegExp((r?"^":"")+e+(n?"$":""),"u"+(a?"":"i")).test(t)?!o:o}catch(e){return!1}}export function matchRr(e,t,r,n,a,o){matchRe(rrToRe(e),t,r,n,a,o)}const TOKEN_END_RE=new RegExp("‚¶ò"),NOT_TOKEN_END_RE=new RegExp("[^‚¶ò]*"),REREAD_SIMPLE_MODE={start:[{regex:new RegExp("‚çø"),token:"rr-bracket rr-escape",next:"escaped"},{regex:new RegExp("‚ßª.*"),token:"rr-comment"},{regex:new RegExp(TOKEN.CHAR),token:"rr-char rr-bracket",next:"char"},{regex:new RegExp(TOKEN.TEXT),token:"rr-text rr-bracket",next:"text"},{regex:new RegExp(TOKEN.OPERATOR),token:"rr-operator rr-bracket",next:"operator"},{regex:new RegExp(TOKEN.QUANT),token:"rr-count rr-bracket",next:"count"},{regex:new RegExp(TOKEN.QUANT_LAZY),token:"rr-count rr-bracket",next:"lazy"},{regex:new RegExp("[‚¶Ö‚¶Ü]"),token:"rr-symbol"},{regex:/./,token:null}],char:[{regex:TOKEN_END_RE,token:"rr-char rr-bracket rr-end",pop:!0,next:"start"},{regex:NOT_TOKEN_END_RE,token:"rr-char rr-token"}],text:[{regex:TOKEN_END_RE,token:"rr-text rr-bracket rr-end",pop:!0,next:"start"},{regex:NOT_TOKEN_END_RE,token:"rr-text rr-token"}],operator:[{regex:TOKEN_END_RE,token:"rr-operator rr-bracket rr-end",pop:!0,next:"start"},{regex:NOT_TOKEN_END_RE,token:"rr-operator rr-token"}],count:[{regex:TOKEN_END_RE,token:"rr-count rr-bracket rr-end",pop:!0,next:"start"},{regex:NOT_TOKEN_END_RE,token:"rr-count rr-token"}],lazy:[{regex:TOKEN_END_RE,token:"rr-count rr-bracket rr-end",pop:!0,next:"start"},{regex:NOT_TOKEN_END_RE,token:"rr-lazy rr-token"}],escaped:[{regex:/[^]/,token:null,pop:!0,next:"start"}],meta:{lineComment:"‚ßª"}};CodeMirror.defineSimpleMode("reread",REREAD_SIMPLE_MODE);const rereadKeyMap={"Shift-Enter":function(e){const t=TOKEN.CHAR+"‚§∂‚¶ò";e.replaceSelection(t+"\n")}};function clearRrAtoms(e){e.getAllMarks().forEach((e=>{e.className&&e.className.includes("rr-atomic-unit")&&e.clear()}))}function setRrAtoms(e){e.operation((()=>{clearRrAtoms(e),"reread"===e.getOption("mode")&&e.eachLine((t=>{const r=t.text;if(r.startsWith("‚ßª"))return;const n=e.getLineNumber(t);RR_TOKEN_REGEX.lastIndex=0;let a,o=[];const i={line:n,ch:0},c={line:n,ch:0},s=r.match(RR_COMMENT_REGEX);for(;a=RR_TOKEN_REGEX.exec(r);){if(i.ch=a.index,c.ch=a.index+a[0].length,s&&s.index+1<i.ch)return;let t=sortedRereadPatterns.find((e=>e.rr===a[0]))||a[0].startsWith(TOKEN.CHAR+"[")&&a[0].endsWith("]‚¶ò")||a[0].startsWith(TOKEN.QUANT)||a[0].startsWith(TOKEN.QUANT_LAZY);t?e.markText(i,c,{atomic:!0,className:"rr-atomic-unit",title:t.hint||""}):o.push([{line:n,ch:i.ch},{line:n,ch:c.ch}])}for(;o.length;)e.replaceRange("",...o.pop())}))}))}function addRrToggles(e){if(e.rrCaseBtn&&e.getWrapperElement().contains(e.rrCaseBtn))return;e.rrCaseBtn=document.createElement("span"),e.rrCaseBtn.textContent="Aa",e.rrCaseBtn.className="rr-case-button",e.rrCaseBtn.title="Match Case (when selected, the text pattern is case-sensitive)",e.rrCaseSensitive&&e.rrCaseBtn.classList.add("selected"),e.rrCaseBtn.onclick=()=>e.rrSetCaseSensitive(!e.rrCaseSensitive),e.rrSetCaseSensitive=function(t){e.rrCaseSensitive=t,t?e.rrCaseBtn.classList.add("selected"):e.rrCaseBtn.classList.remove("selected"),e.triggerChangeEvent()},e.rrWholeTextBtn=document.createElement("span"),e.rrWholeTextBtn.textContent="ab",e.rrWholeTextBtn.className="rr-whole-text-button",e.rrWholeTextBtn.title="Match Whole Text (when selected, the pattern must match at entire text, not just part of it)",e.rrMatchWholeText&&e.rrWholeTextBtn.classList.add("selected"),e.rrWholeTextBtn.onclick=()=>e.rrSetWholeText(!e.rrMatchWholeText),e.rrSetWholeText=function(t){e.rrMatchWholeText=t,t?e.rrWholeTextBtn.classList.add("selected"):e.rrWholeTextBtn.classList.remove("selected"),e.triggerChangeEvent()};const t=document.createElement("span");t.appendChild(e.rrCaseBtn),t.appendChild(e.rrWholeTextBtn),e.setBookmark({line:0,ch:0},{widget:t})}function modeLoad(e){setRrAtoms(e),addRrToggles(e);const t=debounce((e=>{setRrAtoms(e),addRrToggles(e)}),300);e.rrChangeHandler=()=>t(e),e.on("change",e.rrChangeHandler),e.addKeyMap(rereadKeyMap),e.triggerChangeEvent=()=>CodeMirror.signal(e,"change",e,{}),e.fromRe=t=>{e.rrCaseSensitive=!RE_IGNORE_CASE_REGEX_TEST.test(t),e.rrMatchWholeText=RE_START_REGEX_TEST.test(t)||RE_END_REGEX_TEST.test(t),e.setValue(reToRr(t))},e.toRe=()=>rrToRe(e.getValue(),e.rrCaseSensitive,e.rrMatchWholeText),e.toRegExp=()=>new RegExp(e.toRe(),"u"),e.test=t=>{try{e.toRegExp().test(t)}catch(e){let t=!1;return t.error=e,t}}}function modeUnload(e){e.rrChangeHandler&&(e.off("change",e.rrChangeHandler),delete e.rrChangeHandler),e.removeKeyMap(rereadKeyMap),clearRrAtoms(e),delete e.toRe,delete e.toRegExp,delete e.fromRe,delete e.test,delete e.rrSetCaseSensitive,delete e.rrSetWholeText,delete e.rrCaseSensitive,delete e.rrMatchWholeText,delete e.rrCaseBtn,delete e.rrWholeTextBtn}CodeMirror.defineInitHook((function(e){function t(){var t="reread"===e.getOption("mode"),r=e.reread_loaded;t&&!r?(e.reread_loaded=!0,modeLoad(e)):!t&&r&&(e.reread_loaded=!1,modeUnload(e))}e.on("optionChange",(function(e,r){"mode"===r&&t()})),t()}));const CSS="\n.rr-case-button, .rr-whole-text-button {\n  --btn-bg-color: #eee;\n  --btn-txt-color: #55b;\n  font-size: 60%;\n  font-family: \"Arial Narrow\";\n  background-color: var(--btn-bg-color);\n  color: var(--btn-txt-color);\n  border: solid 1px var(--btn-txt-color);\n  border-radius: 4px;\n  padding: 1px;\n  margin-right: 1px;\n  position: relative;\n  width: 1.3em;\n  height: 1.3em;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  transform: translate(-2px, -3px);\n}\n.rr-case-button:hover, .rr-whole-text-button:hover {\n  cursor: pointer;\n  outline: 1px solid #888;\n}\n.rr-case-button.selected, .rr-whole-text-button.selected {\n  background-color: var(--btn-txt-color);\n  color: var(--btn-bg-color);\n}\n.rr-whole-text-button:after {\n  content:\" \";\n  border-radius: 1px;\n  border-bottom: solid 1px currentColor;\n  border-left: solid 1px currentColor;\n  border-right: solid 1px currentColor;\n  position: absolute;\n  right: 1.5px;\n  left: 1.5px;\n  bottom: 2px;\n  height: 3px;\n}\n\n.rr-button-row {\n  display: flex;\n  flex-wrap: wrap;\n  place-content: flex-start center;\n  gap: 0.25em;\n  font-size: 85%;\n}\n.rr-button-row > .rr-dropdown-button {\n  border-radius: 4px !important;\n}\n.rr-button-row > * {\n  padding: .1em .75em;\n  border-radius: 4px;\n  color: #ccc;\n  position: relative;\n  display: inline-flex;\n  justify-content: center;\n  align-items: center;\n  background-color: #444;\n}\n.rr-button-row > *:hover {\n  cursor: pointer;\n  outline: 1px solid #888;\n}\n.rr-button-row > * > .rr-button-menu {\n  visibility: hidden;\n  z-index: 10;\n  padding: 1em;\n  background-color: #eee;\n  box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;\n  color: black;\n  position: absolute;\n  top: 100%;\n  left: 50%;\n  transform: translateX(-50%);\n  width: max-content;\n  max-width: 300px;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5em;\n}\n.rr-button-row > *:hover > .rr-button-menu {\n  visibility: visible;\n}\n.rr-button-menu .rr-button-row:not(:last-child) {\n  padding-bottom: 0.5em;\n  border-bottom: 1px dashed #888;\n}\n.rr-button-menu .selectable {\n  background-color: #333;\n  box-sizing: border-box;\n  border: 2px solid transparent; \n  height: 2em;\n}\n.rr-button-menu .selectable:before {\n  content: '‚úó ';\n}\n.rr-button-menu .selectable.selected:before {\n  content: '‚úî ';\n}\n.rr-button-menu .selectable.selected {\n  border: inset 2px gray;\n}\n\n.rr-token, .cm-rr-token {\n  font-size: 70%;\n  margin-left: .75px;\n}\n\n.rr-comment-btn {\n  background-color: #888;\n  color: #fff;\n  font-style: italic;\n}\n.rr-comment, .cm-rr-comment {\n  padding-left: .15em;\n  color: #888;\n  font-style: italic;\n}\n\n.rr-symbol, .cm-rr-symbol {\n  color: #808;\n}\n\n.rr-operator, .cm-rr-operator {\n  background-color: #ddd;\n  color: #808;\n}\n\n.rr-char, .cm-rr-char {\n  background-color: #fc8;\n  color: #004;\n  border-radius: 1px;\n  padding: 0 0.5em;\n}\n\n.rr-text, .cm-rr-text {\n  background-color: #8dd;\n  color: #004;\n  border-radius: 999em;\n  padding: 0 0.5em;\n}\n\n.rr-count, .cm-rr-count, .rr-lazy, .cm-rr-lazy {\n  background-color: #355;\n  color: #eee;\n  padding: 0 0.5em;\n  border-radius: 0 999em 999em 0;\n  /*\n  --radius: .2em;\n  -webkit-mask: radial-gradient(circle var(--radius) at -5% 50%, transparent 0, transparent var(--radius), black var(--radius));\n  mask: radial-gradient(circle var(--radius) at -5% 50%, transparent 0, transparent var(--radius), black var(--radius));\n  */\n}\n.rr-lazy, .cm-rr-lazy {\n  background-color: #688;\n  color: #eee;\n}\n\n.cm-rr-bracket {\n  color: transparent;\n  font-size: 0px;\n  margin: 0px;\n  padding: 0px;\n}\n\n.cm-rr-escape {\n  font-size: 1px;\n}\n";document.head.appendChild(Object.assign(document.createElement("style"),{textContent:CSS}));