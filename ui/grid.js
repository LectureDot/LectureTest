import{isNum,isStr,newEl,pad0,span}from"./common.js";import styles from"./grid.css"with{type:"css"};document.adoptedStyleSheets.push(styles);export function grid(e,t,n,r){n.className?n.className+=" grid":n.className="grid";const o=newEl(n,r);o.setCols=e=>o.style.setProperty("--cols",e),o.addRow=function(e,t={},n){const r=newEl(t);isNum(n)&&n<o.children.length?o.insertBefore(r,o.children[n]):o.appendChild(r);for(let t of e)t instanceof HTMLElement?r.appendChild(t):span({innerHTML:t.toString()},r);return e.length&&o.setCols(e.length),r},o.setHeader=function(e){o.headerRow&&o.headerRow.remove(),o.headerRow=o.addRow(e,{className:"header"},0),console.log(o.headerRow);for(let e=0;e<o.headerRow.children.length;e++){o.headerRow.children[e].addEventListener("click",(t=>o.sort(e)))}},o.sortDirection=[],o.sort=function(e){let t=o.sortDirection[e]||1;o.sortDirection[e]=-t,[...o.children].slice(1).toSorted(((n,r)=>getElementText(n.children[e])>getElementText(r.children[e])?t:-t)).forEach((e=>o.appendChild(e)))},e&&o.setHeader(e);for(let e of t)o.addRow(e);return o}function getElementText(e){if(isStr(e))return e;if(!e)return"";let t="";e.textContent?t+=e.textContent:void 0!==e.value&&null!==e.value?t+=e.value:e.className&&(t+=e.className);let n=parseFloat(t);if(!isNaN(n)){let[e,r]=n.toString().split(".");t=e.padStart(7,"0")+"."+(r||"0").padEnd(7,"0")+t.slice(n.toString().length)}if(e.children&&e.children.length>0)for(const n of e.children)t+=getElementText(n);return t.toLowerCase()}