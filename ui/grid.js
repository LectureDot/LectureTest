import{arrayToCsv,isNum,isStr,newEl,pad0,span}from"./common.js";import styles from"./grid.css"with{type:"css"};document.adoptedStyleSheets.push(styles);export function grid(e,t,r,o){r.className?r.className+=" grid":r.className="grid";const n=newEl(r,o);n.setCols=e=>n.style.setProperty("--cols",e),n.addRow=function(e,t={},r){const o=newEl(t);isNum(r)&&r<n.children.length?n.insertBefore(o,n.children[r]):n.appendChild(o);for(let t of e)t instanceof HTMLElement?o.appendChild(t):span({innerHTML:t.toString()},o);return e.length&&n.setCols(e.length),o},n.setHeader=function(e){n.headerRow&&n.headerRow.remove(),n.headerRow=n.addRow(e,{className:"header"},0),console.log(n.headerRow);for(let e=0;e<n.headerRow.children.length;e++){n.headerRow.children[e].addEventListener("click",(t=>n.sort(e)))}},n.clearDataRows=function(){for(let e of[...n.children])e!==n.headerRow&&e.remove()},n.getCSV=function(){return arrayToCsv([...n.children].map((e=>[...e.children].map((e=>isNaN(Number(e.textContent))?e.textContent:Number(e.textContent))))))},n.sortDirection=[],n.resort=function(){n.sortDirection[n.lastSort||0]*=-1,n.sort(n.lastSort||0)},n.sort=function(e,t=!0){clearTimeout(n.sortTimeout),n.lastSort=e,n.sortTimeout=setTimeout((()=>{let r;r=t?n.sortDirection[e]||1:t?1:-1,n.sortDirection[e]=-r,[...n.children].slice(1).toSorted(((t,o)=>getElementText(t.children[e])>getElementText(o.children[e])?r:-r)).forEach((e=>n.appendChild(e)))}),50)},e&&n.setHeader(e);for(let e of t)n.addRow(e);return n}function getElementText(e){if(isStr(e))return e;if(!e)return"";let t="";e.textContent?t+=e.textContent:void 0!==e.value&&null!==e.value?t+=e.value:e.className&&(t+=e.className);let r=parseFloat(t);if(!isNaN(r)){let[e,o]=r.toString().split(".");t=e.padStart(7,"0")+"."+(o||"0").padEnd(7,"0")+t.slice(r.toString().length)}if(e.children&&e.children.length>0)for(const r of e.children)t+=getElementText(r);return t.toLowerCase()}